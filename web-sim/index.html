<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LSOAS ‚Äî Lunar Mission Control</title>
    <meta
      name="description"
      content="Lunar Surface Operations Autonomous Science Network ‚Äî A Chandrayaan-themed lunar mission control simulation for teaching swarm rover operations."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <!-- ‚îÄ‚îÄ‚îÄ Top Bar ‚îÄ‚îÄ‚îÄ -->
    <header id="top-bar">
      <div class="top-bar-left">
        <div class="logo-mark" id="logo-mark">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
            <circle
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="1.5"
            />
            <circle cx="12" cy="12" r="3" fill="currentColor" />
            <path
              d="M12 2 C17 7 17 17 12 22"
              stroke="currentColor"
              stroke-width="1"
            />
            <path
              d="M12 2 C7 7 7 17 12 22"
              stroke="currentColor"
              stroke-width="1"
            />
            <line
              x1="2"
              y1="12"
              x2="22"
              y2="12"
              stroke="currentColor"
              stroke-width="1"
            />
          </svg>
        </div>
        <span class="top-bar-title">LSOAS</span>
        <span class="top-bar-subtitle">Lunar Surface Operations</span>
      </div>
      <div class="top-bar-center">
        <div class="sim-clock" id="sim-clock">
          <span class="clock-label">MET</span>
          <span class="clock-value" id="met-value">00:00:00</span>
        </div>
      </div>
      <div class="top-bar-right">
        <div class="connection-indicator" id="connection-indicator">
          <span class="conn-dot"></span>
          <span class="conn-text">SIM ACTIVE</span>
        </div>
        <button
          class="cmd-btn-sm"
          id="btn-3d-toggle"
          title="Toggle Orbital View"
          aria-expanded="false"
        >
          <span class="btn-moon-icon">üåë</span>
          <span id="btn-3d-toggle-label">Orbital View</span>
        </button>
        <button
          class="btn-icon"
          id="btn-theme"
          title="Toggle theme"
          aria-label="Toggle theme"
        >
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
          >
            <circle cx="12" cy="12" r="5" />
            <path
              d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
            />
          </svg>
        </button>
      </div>
    </header>

    <!-- ‚îÄ‚îÄ‚îÄ Fleet Summary Banner ‚îÄ‚îÄ‚îÄ -->
    <section id="fleet-banner" aria-label="Fleet Summary">
      <div class="fleet-banner-item">
        <span class="fleet-banner-label">Total Rovers</span>
        <span class="fleet-banner-value" id="fleet-total-rovers">3</span>
      </div>
      <div class="fleet-banner-item">
        <span class="fleet-banner-label">State Distribution</span>
        <span class="fleet-banner-value" id="fleet-state-distribution"
          >3 IDLE ¬∑ 0 EXECUTING ¬∑ 0 SAFE_MODE</span
        >
      </div>
      <div class="fleet-banner-item">
        <span class="fleet-banner-label">Average Battery</span>
        <span class="fleet-banner-value" id="fleet-avg-battery">100%</span>
      </div>
      <div class="fleet-banner-item">
        <span class="fleet-banner-label">Commands / ACKs</span>
        <span class="fleet-banner-value" id="fleet-command-ack">0 / 0</span>
      </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ Main Layout ‚îÄ‚îÄ‚îÄ -->
    <main id="main-grid">
      <!-- ‚îÅ‚îÅ‚îÅ LEFT: Operations Streams ‚îÅ‚îÅ‚îÅ -->
      <section class="panel panel-topology" id="panel-topology">
        <div class="panel-header">
          <h2>Operations Streams</h2>
          <span class="badge badge-live">3 Tabs</span>
        </div>
        <div class="dropdown-stack left-dropdown-stack" id="left-dropdown-stack">
          <section
            class="dropdown-block is-open"
            id="left-command-log-block"
            data-accordion-group="left-orbital"
            data-default-open="true"
          >
            <button class="dropdown-toggle" type="button" aria-expanded="true">
              <span class="dropdown-title">Command Log</span>
              <span class="dropdown-meta">Earth uplink stream</span>
              <span class="dropdown-chevron" aria-hidden="true"></span>
            </button>
            <div class="dropdown-content">
              <div class="command-log command-log-left" id="command-log">
                <div class="feed-empty">
                  <span>No commands sent yet</span>
                </div>
              </div>
            </div>
          </section>

          <section
            class="dropdown-block is-open"
            id="left-pending-ack-block"
            data-accordion-group="left-orbital"
            data-default-open="true"
          >
            <button class="dropdown-toggle" type="button" aria-expanded="true">
              <span class="dropdown-title">Pending ACKs</span>
              <span class="pending-count" id="pending-count">0</span>
              <span class="dropdown-chevron" aria-hidden="true"></span>
            </button>
            <div class="dropdown-content">
              <div class="pending-acks pending-acks-left" id="pending-acks">
                <span class="pending-none">No pending commands</span>
              </div>
            </div>
          </section>

          <section
            class="dropdown-block is-open"
            id="left-topology-block"
            data-accordion-group="left-orbital"
            data-default-open="true"
          >
            <button class="dropdown-toggle" type="button" aria-expanded="true">
              <span class="dropdown-title">Network Topology</span>
              <span class="dropdown-meta">4 mission nodes</span>
              <span class="dropdown-chevron" aria-hidden="true"></span>
            </button>
            <div class="dropdown-content">
              <div class="topology-visual" id="topology-visual">
                <!-- Topology Canvas (SVG-based connection lines) -->
                <svg
                  class="topology-lines"
                  id="topology-lines"
                  preserveAspectRatio="none"
                ></svg>

                <!-- Nodes... -->

                <!-- Earth Node -->
                <div class="topo-node" id="topo-earth" data-node="earth">
                  <div class="topo-node-ring">
                    <div class="topo-node-icon">üåç</div>
                  </div>
                  <span class="topo-node-label">Earth Station</span>
                  <span class="topo-node-state" id="earth-state">ONLINE</span>
                </div>

                <!-- Space Link Node -->
                <div class="topo-node" id="topo-spacelink" data-node="spacelink">
                  <div class="topo-node-ring">
                    <div class="topo-node-icon">üõ∞Ô∏è</div>
                  </div>
                  <span class="topo-node-label">Space Link</span>
                  <span class="topo-node-state" id="spacelink-state">RELAY</span>
                </div>

                <!-- Rover Node -->
                <div class="topo-node" id="topo-rover" data-node="rover">
                  <div class="topo-node-ring">
                    <div class="topo-node-icon">ü§ñ</div>
                  </div>
                  <span class="topo-node-label">Lunar Rover</span>
                  <span class="topo-node-state" id="rover-state">IDLE</span>
                </div>

                <!-- Telemetry Monitor -->
                <div class="topo-node" id="topo-telemetry" data-node="telemetry">
                  <div class="topo-node-ring">
                    <div class="topo-node-icon">üì°</div>
                  </div>
                  <span class="topo-node-label">Telemetry</span>
                  <span class="topo-node-state" id="telemetry-state"
                    >LISTENING</span
                  >
                </div>
              </div>

              <!-- Signal Flow Indicators -->
              <div class="signal-legend">
                <div class="signal-legend-item">
                  <span class="signal-arrow up">‚Üë</span> Uplink (Cmd)
                </div>
                <div class="signal-legend-item">
                  <span class="signal-arrow down">‚Üì</span> Downlink (Tlm)
                </div>
              </div>
            </div>
          </section>
        </div>
      </section>

      <!-- ‚îÅ‚îÅ‚îÅ CENTER: Telemetry & Details ‚îÅ‚îÅ‚îÅ -->
      <section class="panel panel-telemetry" id="panel-telemetry">
        <div class="panel-header">
          <h2>Telemetry Stream</h2>
          <div class="panel-header-actions">
            <button class="btn-sm" id="btn-clear-telemetry">Clear</button>
          </div>
        </div>

        <div
          class="dropdown-stack telemetry-dropdown-stack"
          id="telemetry-dropdown-stack"
        >
          <section
            class="dropdown-block is-open"
            id="telemetry-fleet-block"
            data-accordion-group="telemetry-orbital"
            data-default-open="true"
          >
            <button class="dropdown-toggle" type="button" aria-expanded="true">
              <span class="dropdown-title">Fleet Status</span>
              <span class="dropdown-meta">Rover cards and pinning</span>
              <span class="dropdown-chevron" aria-hidden="true"></span>
            </button>
            <div class="dropdown-content">
              <div class="fleet-grid-panel" id="fleet-grid-panel">
                <div class="fleet-grid-toolbar">
                  <span class="fleet-grid-summary" id="fleet-grid-summary"
                    >Showing 0 of 0 rovers</span
                  >
                  <button class="btn-sm" id="btn-toggle-fleet-scope">
                    Show All
                  </button>
                </div>
                <div class="fleet-grid" id="fleet-grid" aria-live="polite">
                  <div class="feed-empty">
                    <span class="feed-empty-icon">ü§ñ</span>
                    <span>Awaiting fleet telemetry‚Ä¶</span>
                  </div>
                </div>
                <div class="fleet-hover-card" id="fleet-hover-card" hidden></div>
              </div>
            </div>
          </section>

          <section
            class="dropdown-block is-open"
            id="telemetry-stream-block"
            data-accordion-group="telemetry-orbital"
            data-default-open="true"
          >
            <button class="dropdown-toggle" type="button" aria-expanded="true">
              <span class="dropdown-title">Telemetry Stream</span>
              <span class="dropdown-meta">Live downlink events</span>
              <span class="dropdown-chevron" aria-hidden="true"></span>
            </button>
            <div class="dropdown-content">
              <div class="telemetry-feed" id="telemetry-feed">
                <div class="feed-empty">
                  <span class="feed-empty-icon">üì°</span>
                  <span>Awaiting telemetry‚Ä¶</span>
                </div>
              </div>
              <div class="telemetry-last-line" id="telemetry-last-line">
                <span class="telemetry-last-label">Last Log</span>
                <span class="telemetry-last-value" id="telemetry-last-value"
                  >Awaiting telemetry‚Ä¶</span
                >
              </div>
            </div>
          </section>
        </div>
      </section>

      <!-- ‚îÄ‚îÄ‚îÄ Lunar Orbital Panel ‚îÄ‚îÄ‚îÄ -->
      <aside id="floating-panel" aria-hidden="true">
        <div class="floating-panel-shell">
          <div class="floating-panel-header">
            <div class="floating-panel-title-wrap">
              <span class="floating-panel-grab" aria-hidden="true"></span>
              <h3>Orbital Mission View</h3>
              <span class="floating-panel-meta" id="lunar-meta"
                >Drag to rotate ¬∑ Scroll to zoom</span
              >
            </div>
            <div class="floating-panel-kpis" id="lunar-panel-kpis">
              <div class="lunar-kpi" id="lunar-kpi-rover-card">
                <span class="lunar-kpi-label">Selected</span>
                <span class="lunar-kpi-value" id="lunar-kpi-rover">--</span>
              </div>
              <div class="lunar-kpi" id="lunar-kpi-los-card">
                <span class="lunar-kpi-label">LOS</span>
                <span class="lunar-kpi-value" id="lunar-kpi-los">Pending</span>
              </div>
              <div class="lunar-kpi" id="lunar-kpi-links-card">
                <span class="lunar-kpi-label">Links</span>
                <span class="lunar-kpi-value" id="lunar-kpi-links">0 / 0</span>
              </div>
              <div class="lunar-kpi">
                <span class="lunar-kpi-label">Zoom</span>
                <span class="lunar-kpi-value" id="lunar-kpi-zoom">--</span>
              </div>
              <div class="lunar-kpi">
                <span class="lunar-kpi-label">Fleet</span>
                <span class="lunar-kpi-value" id="lunar-kpi-fleet">0</span>
              </div>
            </div>
            <button
              id="btn-close-3d"
              class="btn-icon floating-close-btn"
              title="Close Orbital View"
              aria-label="Close Orbital View"
            >
              ‚úï
            </button>
          </div>
          <div id="visualization-container"></div>
        </div>
      </aside>

      <!-- ‚îÅ‚îÅ‚îÅ RIGHT: Command Console ‚îÅ‚îÅ‚îÅ -->
      <section class="panel panel-command" id="panel-command">
        <div class="panel-header">
          <h2>Command Console</h2>
          <span class="badge badge-earth">Earth Station</span>
        </div>

        <div class="dropdown-stack right-dropdown-stack" id="right-dropdown-stack">
          <section
            class="dropdown-block is-open"
            data-accordion-group="right-controls"
          >
            <button class="dropdown-toggle" type="button" aria-expanded="true">
              <span class="dropdown-title">Mission Controls</span>
              <span class="dropdown-meta">Guide, task setup, and dispatch</span>
              <span class="dropdown-chevron" aria-hidden="true"></span>
            </button>
            <div class="dropdown-content">
              <div class="command-section command-section-inner">
                <div class="mission-guide-toolbar">
                  <button class="btn-sm" id="mission-apply-btn" type="button">
                    Apply Preset
                  </button>
                  <button class="btn-sm" id="mission-next-step-btn" type="button">
                    Use Next Step
                  </button>
                  <button class="btn-sm" id="mission-reset-btn" type="button">
                    Reset Guide
                  </button>
                </div>
                <ol class="mission-step-list" id="mission-step-list"></ol>

                <div class="control-subheading">Quick Commands</div>
                <div class="command-grid">
                  <button class="cmd-btn cmd-start" id="cmd-start-task">
                    <span class="cmd-icon">‚ñ∂</span>
                    <span class="cmd-label">Start Task</span>
                  </button>
                  <button class="cmd-btn cmd-abort" id="cmd-abort">
                    <span class="cmd-icon">‚èπ</span>
                    <span class="cmd-label">Abort</span>
                  </button>
                  <button class="cmd-btn cmd-safe" id="cmd-go-safe">
                    <span class="cmd-icon">üõ°</span>
                    <span class="cmd-label">Safe Mode</span>
                  </button>
                  <button class="cmd-btn cmd-reset" id="cmd-reset">
                    <span class="cmd-icon">‚Üª</span>
                    <span class="cmd-label">Reset</span>
                  </button>
                </div>

                <div class="control-subheading">Task Configuration</div>
                <div class="input-group">
                  <label for="rover-target-select">Target Rover</label>
                  <select id="rover-target-select" class="input-field select-field">
                    <option value="auto">Auto-Select (Best Rover)</option>
                  </select>
                </div>
                <div class="input-group">
                  <label for="task-id-input">Task ID</label>
                  <div class="task-id-row">
                    <input
                      type="text"
                      id="task-id-input"
                      class="input-field"
                      placeholder="e.g. CY3-SCI-L2-001"
                      value="CY3-SCI-L2-001"
                    />
                    <button
                      class="btn-sm task-id-regenerate-btn"
                      id="task-id-regenerate-btn"
                      type="button"
                    >
                      Regenerate
                    </button>
                  </div>
                  <div class="task-id-meta">
                    <label class="task-id-toggle-label" for="task-id-auto-toggle">
                      <input type="checkbox" id="task-id-auto-toggle" checked />
                      Auto-generate
                    </label>
                    <span class="task-id-preview" id="task-id-preview"></span>
                  </div>
                </div>
                <div class="input-group">
                  <label for="task-type-select">Task Type</label>
                  <select id="task-type-select" class="input-field select-field">
                    <option value="movement">Movement/Traverse</option>
                    <option value="science">Science Investigation</option>
                    <option value="digging">Digging/Drilling</option>
                    <option value="pushing">Pushing/Regolith Handling</option>
                    <option value="photo">Photo/Imaging Survey</option>
                    <option value="sample-handling">Sample Handling/Transfer</option>
                  </select>
                </div>
                <div class="input-group">
                  <label for="task-difficulty-select">Difficulty</label>
                  <select
                    id="task-difficulty-select"
                    class="input-field select-field"
                  >
                    <option value="L1">L1 - Very Easy</option>
                    <option value="L2" selected>L2 - Easy</option>
                    <option value="L3">L3 - Moderate</option>
                    <option value="L4">L4 - Hard</option>
                    <option value="L5">L5 - Extreme</option>
                  </select>
                </div>
                <div class="input-group">
                  <label for="target-site-input">Target Site (optional)</label>
                  <input
                    type="text"
                    id="target-site-input"
                    class="input-field"
                    placeholder="e.g. Shiv Shakti Point Sector-A"
                  />
                </div>

                <section
                  class="dropdown-block nested-dropdown-block"
                  id="advanced-controls-block"
                >
                  <button
                    class="dropdown-toggle"
                    type="button"
                    aria-expanded="false"
                  >
                    <span class="dropdown-title">Advanced Controls</span>
                    <span class="dropdown-meta"
                      >Fine-grained link and risk tuning</span
                    >
                    <span class="dropdown-chevron" aria-hidden="true"></span>
                  </button>
                  <div class="dropdown-content" hidden>
                    <div class="input-group">
                      <label for="latency-slider"
                        >Base Latency
                        <span class="param-value" id="latency-value">1.3s</span></label
                      >
                      <input
                        type="range"
                        id="latency-slider"
                        class="range-input"
                        min="0"
                        max="5"
                        step="0.1"
                        value="1.3"
                      />
                    </div>
                    <div class="input-group">
                      <label for="jitter-slider"
                        >Jitter
                        <span class="param-value" id="jitter-value"
                          >¬±0.2s</span
                        ></label
                      >
                      <input
                        type="range"
                        id="jitter-slider"
                        class="range-input"
                        min="0"
                        max="2"
                        step="0.05"
                        value="0.2"
                      />
                    </div>
                    <div class="input-group">
                      <label for="drop-slider"
                        >Drop Rate
                        <span class="param-value" id="drop-value">5%</span></label
                      >
                      <input
                        type="range"
                        id="drop-slider"
                        class="range-input"
                        min="0"
                        max="50"
                        step="1"
                        value="5"
                      />
                    </div>
                    <div class="input-group">
                      <label for="fault-slider"
                        >Risk Bias
                        <span class="param-value" id="fault-prob-value">0%</span></label
                      >
                      <input
                        type="range"
                        id="fault-slider"
                        class="range-input"
                        min="-20"
                        max="20"
                        step="1"
                        value="0"
                      />
                    </div>
                  </div>
                </section>
              </div>
            </div>
          </section>

          <section
            class="dropdown-block is-open"
            data-accordion-group="right-controls"
          >
            <button class="dropdown-toggle" type="button" aria-expanded="true">
              <span class="dropdown-title">Mission Explanation</span>
              <span class="dropdown-meta">Theme and payload context</span>
              <span class="dropdown-chevron" aria-hidden="true"></span>
            </button>
            <div class="dropdown-content">
              <div class="command-section command-section-inner">
                <div class="input-group">
                  <label for="mission-preset-select">Mission Preset</label>
                  <select id="mission-preset-select" class="input-field select-field">
                    <option value="cy3-pragyan" selected>
                      Chandrayaan-3 Pragyan Surface Ops
                    </option>
                    <option value="cy4-sample-return">
                      Chandrayaan-4 Sample Return Chain
                    </option>
                    <option value="lupex-polar-ice">LUPEX Polar Ice Prospecting</option>
                    <option value="cy-future-base">
                      Future Chandrayaan Base Build (Teaching Scenario)
                    </option>
                  </select>
                </div>
                <article class="mission-brief-card" id="mission-brief-card">
                  <div class="mission-brief-head">
                    <span class="mission-brief-code" id="mission-brief-code">CY3</span>
                    <span class="mission-brief-phase" id="mission-brief-phase"
                      >CY3-ops</span
                    >
                  </div>
                  <p class="mission-brief-summary" id="mission-brief-summary">
                    Pragyan-style near-surface traverse and in-situ science sequence.
                  </p>
                  <div class="mission-brief-tags" id="mission-brief-tags"></div>
                </article>
              </div>
            </div>
          </section>
        </div>
      </section>
    </main>

    <!-- ‚îÄ‚îÄ‚îÄ Bottom Status Bar ‚îÄ‚îÄ‚îÄ -->
    <footer id="bottom-bar">
      <span class="footer-item">
        <span class="footer-dot green"></span>
        Simulation Engine: Running
      </span>
      <span class="footer-item" id="footer-packets">
        Packets: <strong id="packets-sent">0</strong> sent ¬∑
        <strong id="packets-received">0</strong> received ¬∑
        <strong id="packets-dropped">0</strong> dropped
      </span>
      <span class="footer-item" id="footer-uptime">
        Session: <span id="session-time">0s</span>
      </span>
    </footer>

    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.160.0/examples/js/loaders/STLLoader.js"></script>
    <script src="lunar3d.js"></script>
    <script src="simulation.js"></script>
    <script src="app.js"></script>
  </body>
</html>
